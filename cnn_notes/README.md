# Here is a reminder of how the convolutional layer works in TensorFlow.
## 1. The image has just one channel. 
We have a layer that has 10 2*2 matrices:
```
weights(transposed):
tf.Tensor(
[[[[ 0. 10.]
   [20. 30.]]

  [[ 1. 11.]
   [21. 31.]]

  ...

  [[ 9. 19.]
   [29. 39.]]]], shape=(1, 10, 2, 2), dtype=float32)
```
Grey image(10 * 10):
```
 [[ 0  1  2  3  4  5  6  7  8  9]
  [10 11 12 13 14 15 16 17 18 19]
  [20 21 22 23 24 25 26 27 28 29]
  [30 31 32 33 34 35 36 37 38 39]
  [40 41 42 43 44 45 46 47 48 49]
  [50 51 52 53 54 55 56 57 58 59]
  [60 61 62 63 64 65 66 67 68 69]
  [70 71 72 73 74 75 76 77 78 79]
  [80 81 82 83 84 85 86 87 88 89]
  [90 91 92 93 94 95 96 97 98 99]]
```
***Important note that here matrices of the weights aren't flipped as the [theory](http://www.songho.ca/dsp/convolution/convolution2d_example.html) requires.***
```
0 * 0 + 10 * 1 + 20 * 10 + 30 * 11 = 540
1 * 0 + 11 * 1 + 21 * 10 + 31 * 11 = 562
...
```

output(transposed):
```
[[[ 540.  600.  660.  720.  780.  840.  900.  960. 1020.]
  [1140. 1200. 1260. 1320. 1380. 1440. 1500. 1560. 1620.]
  [1740. 1800. 1860. 1920. 1980. 2040. 2100. 2160. 2220.]
  [2340. 2400. 2460. 2520. 2580. 2640. 2700. 2760. 2820.]
  [2940. 3000. 3060. 3120. 3180. 3240. 3300. 3360. 3420.]
  [3540. 3600. 3660. 3720. 3780. 3840. 3900. 3960. 4020.]
  [4140. 4200. 4260. 4320. 4380. 4440. 4500. 4560. 4620.]
  [4740. 4800. 4860. 4920. 4980. 5040. 5100. 5160. 5220.]
  [5340. 5400. 5460. 5520. 5580. 5640. 5700. 5760. 5820.]]

 [[ 562.  626.  690.  754.  818.  882.  946. 1010. 1074.]
  [1202. 1266. 1330. 1394. 1458. 1522. 1586. 1650. 1714.]
  [1842. 1906. 1970. 2034. 2098. 2162. 2226. 2290. 2354.]
  [2482. 2546. 2610. 2674. 2738. 2802. 2866. 2930. 2994.]
  [3122. 3186. 3250. 3314. 3378. 3442. 3506. 3570. 3634.]
  [3762. 3826. 3890. 3954. 4018. 4082. 4146. 4210. 4274.]
  [4402. 4466. 4530. 4594. 4658. 4722. 4786. 4850. 4914.]
  [5042. 5106. 5170. 5234. 5298. 5362. 5426. 5490. 5554.]
  [5682. 5746. 5810. 5874. 5938. 6002. 6066. 6130. 6194.]]

 ...

 [[ 738.  834.  930. 1026. 1122. 1218. 1314. 1410. 1506.]
  [1698. 1794. 1890. 1986. 2082. 2178. 2274. 2370. 2466.]
  [2658. 2754. 2850. 2946. 3042. 3138. 3234. 3330. 3426.]
  [3618. 3714. 3810. 3906. 4002. 4098. 4194. 4290. 4386.]
  [4578. 4674. 4770. 4866. 4962. 5058. 5154. 5250. 5346.]
  [5538. 5634. 5730. 5826. 5922. 6018. 6114. 6210. 6306.]
  [6498. 6594. 6690. 6786. 6882. 6978. 7074. 7170. 7266.]
  [7458. 7554. 7650. 7746. 7842. 7938. 8034. 8130. 8226.]
  [8418. 8514. 8610. 8706. 8802. 8898. 8994. 9090. 9186.]]],
  shape=(10, 9, 9), dtype=float32)
```
## 2. The image has three channels. 
We have a layer that has 10 groups each has 3 2*2 matrices.
```
weights(transposed):
 tf.Tensor(
[[[[  0.  30.]
   [ 60.  90.]]
  [[ 10.  40.]
   [ 70. 100.]]
  [[ 20.  50.]
   [ 80. 110.]]]
 [[[  1.  31.]
   [ 61.  91.]]
  [[ 11.  41.]
   [ 71. 101.]]
  [[ 21.  51.]
   [ 81. 111.]]]
...
 [[[  9.  39.]
   [ 69.  99.]]
  [[ 19.  49.]
   [ 79. 109.]]
  [[ 29.  59.]
   [ 89. 119.]]]], shape=(10, 3, 2, 2), dtype=float32)
```
RGB image:
```
[[[  0   1   2] [  3   4   5] [  6   7   8] [  9  10  11] [ 12  13  14] [ 15  16  17] [ 18  19  20] [ 21  22  23] [ 24  25  26] [ 27  28  29]]
 [[ 30  31  32] [ 33  34  35] [ 36  37  38] [ 39  40  41] [ 42  43  44] [ 45  46  47] [ 48  49  50] [ 51  52  53] [ 54  55  56] [ 57  58  59]]
 ...
 [[270 271 272] [273 274 275] [276 277 278] [279 280 281] [282 283 284] [285 286 287] [288 289 290] [291 292 293] [294 295 296] [297 298 299]]]
```
The first 2 * 2 pixels are:
```
[[[  0   1   2] [  3   4   5]] 
 [[ 30  31  32] [ 33  34  35]]
```
So that:
- channel 1
```
[[ 0  3]
 [30 33]]
```
- channel 2
```
[[ 1  4]
 [31 34]]
```
-channel 3
```
[[ 2  5]
 [32 35]]
```
A first tuple of 2 * 2 matrices from the layer:
```
[[[  0.  30.]
  [ 60.  90.]]
 [[ 10.  40.]
  [ 70. 100.]]
 [[ 20.  50.]
  [ 80. 110.]]]
```
So for the first channel, we should use the first matrix: 
```
0 * 0 + 30 * 3 + 60 * 30 + 90 * 33 = 4860
```
For the second channel:
```
10 * 1 + 40 * 4 + 70 * 31 + 100 * 34 = 5700
```
For the third channel:
```
20 * 2 + 50 * 5 + 80 * 32 + 110 * 35 = 6700
```
Next, we summarize the products from all channels:
```
4860 + 5700 + 6700 = 17300
```
output(transposed):
```
tf.Tensor(
[[[ 17300.  19280.  21260.  23240.  25220.  27200.  29180.  31160. 33140.]
  [ 37100.  39080.  41060.  43040.  45020.  47000.  48980.  50960. 52940.]
  [ 56900.  58880.  60860.  62840.  64820.  66800.  68780.  70760. 72740.]
  [ 76700.  78680.  80660.  82640.  84620.  86600.  88580.  90560. 92540.]
  [ 96500.  98480. 100460. 102440. 104420. 106400. 108380. 110360. 112340.]
  [116300. 118280. 120260. 122240. 124220. 126200. 128180. 130160. 132140.]
  [136100. 138080. 140060. 142040. 144020. 146000. 147980. 149960. 151940.]
  [155900. 157880. 159860. 161840. 163820. 165800. 167780. 169760. 171740.]
  [175700. 177680. 179660. 181640. 183620. 185600. 187580. 189560. 191540.]]
[[ 17510.  19526.  21542.  23558.  25574.  27590.  29606.  31622. 33638.]
  [ 37670.  39686.  41702.  43718.  45734.  47750.  49766.  51782. 53798.]
  [ 57830.  59846.  61862.  63878.  65894.  67910.  69926.  71942. 73958.]
  [ 77990.  80006.  82022.  84038.  86054.  88070.  90086.  92102. 94118.]
  [ 98150. 100166. 102182. 104198. 106214. 108230. 110246. 112262. 114278.]
  [118310. 120326. 122342. 124358. 126374. 128390. 130406. 132422. 134438.]
  [138470. 140486. 142502. 144518. 146534. 148550. 150566. 152582. 154598.]
  [158630. 160646. 162662. 164678. 166694. 168710. 170726. 172742. 174758.]
  [178790. 180806. 182822. 184838. 186854. 188870. 190886. 192902. 194918.]]
 ...
 [[ 19190.  21494.  23798.  26102.  28406.  30710.  33014.  35318. 37622.]
  [ 42230.  44534.  46838.  49142.  51446.  53750.  56054.  58358. 60662.]
  [ 65270.  67574.  69878.  72182.  74486.  76790.  79094.  81398. 83702.]
  [ 88310.  90614.  92918.  95222.  97526.  99830. 102134. 104438. 106742.]
  [111350. 113654. 115958. 118262. 120566. 122870. 125174. 127478. 129782.]
  [134390. 136694. 138998. 141302. 143606. 145910. 148214. 150518. 152822.]
  [157430. 159734. 162038. 164342. 166646. 168950. 171254. 173558. 175862.]
  [180470. 182774. 185078. 187382. 189686. 191990. 194294. 196598. 198902.]
  [203510. 205814. 208118. 210422. 212726. 215030. 217334. 219638. 221942.]]],
  shape=(10, 9, 9), dtype=float32)
```
